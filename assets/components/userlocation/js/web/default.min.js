if("function"!=typeof UserLocationAutoComplete){var UserLocationAutoComplete=function(e){function c(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function n(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function t(n,e,s,t){o(t||document,e,function(e){for(var t,o=e.target||e.srcElement;o&&!(t=c(o,n));)o=o.parentElement;t&&s.call(o,e)})}if(document.querySelector){var a={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="userlocation-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(){}};for(var s in e)e.hasOwnProperty(s)&&(a[s]=e[s]);for(var i="object"==typeof a.selector?[a.selector]:document.querySelectorAll(a.selector),l=0;l<i.length;l++){var r=i[l];function u(e){var t=r.value;if((r.cache[t]=e).length&&t.length>=a.minChars){for(var o="",n=0;n<e.length;n++)o+=a.renderItem(e[n],t);r.sc.innerHTML=o,r.updateSC(0)}else r.sc.style.display="none"}r.sc=document.createElement("div"),r.sc.className="userlocation-suggestions "+a.menuClass,r.autocompleteAttr=r.getAttribute("autocomplete"),r.setAttribute("autocomplete","off"),r.cache={},r.last_val="",r.updateSC=function(e,t){var o=r.getBoundingClientRect();if(r.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+a.offsetLeft)+"px",r.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+a.offsetTop)+"px",r.sc.style.width=Math.round(o.right-o.left)+"px",!e&&(r.sc.style.display="block",r.sc.maxHeight||(r.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(r.sc,null):r.sc.currentStyle).maxHeight)),r.sc.suggestionHeight||(r.sc.suggestionHeight=r.sc.querySelector(".userlocation-suggestion").offsetHeight),r.sc.suggestionHeight))if(t){var n=r.sc.scrollTop,s=t.getBoundingClientRect().top-r.sc.getBoundingClientRect().top;0<s+r.sc.suggestionHeight-r.sc.maxHeight?r.sc.scrollTop=s+r.sc.suggestionHeight+n-r.sc.maxHeight:s<0&&(r.sc.scrollTop=s+n)}else r.sc.scrollTop=0},o(window,"resize",r.updateSC),document.body.appendChild(r.sc),t("userlocation-suggestion","mouseleave",function(){var e=r.sc.querySelector(".userlocation-suggestion.selected");e&&setTimeout(function(){e.className=e.className.replace("selected","")},20)},r.sc),t("userlocation-suggestion","mouseover",function(){var e=r.sc.querySelector(".userlocation-suggestion.selected");e&&(e.className=e.className.replace("selected","")),this.className+=" selected"},r.sc),t("userlocation-suggestion","mousedown",function(e){if(c(this,"userlocation-suggestion")){var t=this.getAttribute("data-val");r.value=t,a.onSelect(e,t,this),r.sc.style.display="none"}},r.sc),r.blurHandler=function(){try{var t=document.querySelector(".userlocation-suggestions:hover")}catch(e){t=0}t?r!==document.activeElement&&setTimeout(function(){r.focus()},20):(r.last_val=r.value,r.sc.style.display="none",setTimeout(function(){r.sc.style.display="none"},350))},o(r,"blur",r.blurHandler),r.keydownHandler=function(e){var t,o=window.event?e.keyCode:e.which;if((40==o||38==o)&&r.sc.innerHTML)return(n=r.sc.querySelector(".userlocation-suggestion.selected"))?(t=40==o?n.nextSibling:n.previousSibling)?(n.className=n.className.replace("selected",""),t.className+=" selected",r.value=t.getAttribute("data-val")):(n.className=n.className.replace("selected",""),r.value=r.last_val,t=0):((t=40==o?r.sc.querySelector(".userlocation-suggestion"):r.sc.childNodes[r.sc.childNodes.length-1]).className+=" selected",r.value=t.getAttribute("data-val")),r.updateSC(0,t),!1;if(27==o)r.value=r.last_val,r.sc.style.display="none";else if(13==o||9==o){var n;(n=r.sc.querySelector(".userlocation-suggestion.selected"))&&"none"!=r.sc.style.display&&(a.onSelect(e,n.getAttribute("data-val"),n),setTimeout(function(){r.sc.style.display="none"},20))}},o(r,"keydown",r.keydownHandler),r.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(t<35||40<t)&&13!=t&&27!=t){var o=r.value;if(o.length>=a.minChars){if(o!=r.last_val){if(r.last_val=o,clearTimeout(r.timer),a.cache){if(o in r.cache)return void u(r.cache[o]);for(var n=1;n<o.length-a.minChars;n++){var s=o.slice(0,o.length-n);if(s in r.cache&&!r.cache[s].length)return void u([])}}r.timer=setTimeout(function(){a.source(o,u)},a.delay)}}else r.last_val=o,r.sc.style.display="none"}},o(r,"keyup",r.keyupHandler),r.focusHandler=function(e){r.last_val="\n",r.keyupHandler(e)},a.minChars||o(r,"focus",r.focusHandler)}this.destroy=function(){for(var e=0;e<i.length;e++){var t=i[e];n(window,"resize",t.updateSC),n(t,"blur",t.blurHandler),n(t,"focus",t.focusHandler),n(t,"keydown",t.keydownHandler),n(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}};"function"==typeof define&&define.amd?define("UserLocationAutoComplete",function(){return UserLocationAutoComplete}):"undefined"!=typeof module&&module.exports?module.exports=UserLocationAutoComplete:window.UserLocationAutoComplete=UserLocationAutoComplete}!function(l){"use strict";function o(e){return e.replace(/(-|\.)(\w)/g,function(e,t){return t.toUpperCase()})}function r(e,t){var n,s;return void 0===t&&(t=l.fn.userlocation.defaults.ns),n=o(t),s=e.data(n)||{},l.each(e.data(),function(e,t){if(0===e.indexOf(n)){var o=function(e){return e.replace(/[A-Z]/g,function(e,t){return(0==t?"":"-")+e.toLowerCase()})}(e.replace(n,""));0<o.length&&(s[o]=t)}}),s}function s(e,t){if("function"==typeof e)return e.apply(t,Array.prototype.slice.call(arguments,2));if("object"==typeof e)for(var o in e){if(e.hasOwnProperty(o))if(!1===e[o].apply(t,Array.prototype.slice.call(arguments,2)))return!1}return!0}var u={service:"userlocation",ctx:document.head.querySelector('meta[name="userlocation:ctx"]').content,actionUrl:document.head.querySelector('meta[name="userlocation:actionUrl"]').content};l.fn.userlocation=function(){},l.fn.userlocation.PROCESS_SUCCESS="userlocation:process-success",l.fn.userlocation.PROCESS_FAILURE="userlocation:process-failure",l.fn.userlocation.PROCESS_ACTION="userlocation:process-action",l.fn.userlocation.defaults={ns:"userlocation",cls:{hidden:"hidden",unconfirmed:"unconfirmed"},timeout:300},l.fn.userlocation.selectors={main:"."+l.fn.userlocation.defaults.ns,localSearch:"."+l.fn.userlocation.defaults.ns+'-location-search-input[data-userlocation-mode="local"]',remoteSearch:"."+l.fn.userlocation.defaults.ns+'-location-search-input[data-userlocation-mode="remote"]',locationItem:"."+l.fn.userlocation.defaults.ns+"-location-item[data-userlocation-id]",locationItemsGroup:"."+l.fn.userlocation.defaults.ns+"-location-items-group",locationConfirm:"."+l.fn.userlocation.defaults.ns+"-location-confirm",locationConfirmClose:"."+l.fn.userlocation.defaults.ns+"-location-confirm-close"},l.fn.userlocation.methodActions={success:{reload_page:function(e,t){var o=e.data.result;o.confirmed&&!o.redirect?location.reload():o.confirmed&&o.redirect&&(location.href=o.redirect)}},failure:{}};var d={init:function(){l(document).off("submit change keyup",l.fn.userlocation.selectors.localSearch).on("submit change keyup",l.fn.userlocation.selectors.localSearch,function(e){var t=d.tools.clearName(l(this).val().toString().toLocaleUpperCase());return l(this).closest(l.fn.userlocation.selectors.main).find(l.fn.userlocation.selectors.locationItemsGroup+" "+l.fn.userlocation.selectors.locationItem).each(function(e){""!==t?0===d.tools.clearName(l(this).text().toLocaleUpperCase()).indexOf(t)?l(this).show().removeClass(l.fn.userlocation.defaults.cls.hidden):l(this).hide().addClass(l.fn.userlocation.defaults.cls.hidden):l(this).show().removeClass(l.fn.userlocation.defaults.cls.hidden)}),l(this).closest(l.fn.userlocation.selectors.main).find(l.fn.userlocation.selectors.locationItemsGroup).each(function(e){l(this).find(l.fn.userlocation.selectors.locationItem).filter(":not(."+l.fn.userlocation.defaults.cls.hidden+")").length?l(this).show().removeClass(l.fn.userlocation.defaults.cls.hidden):l(this).hide().addClass(l.fn.userlocation.defaults.cls.hidden)}),e.preventDefault(),!0}),l(document).find(l.fn.userlocation.selectors.remoteSearch).each(function(t){if("function"==typeof UserLocationAutoComplete){var c=l(this),s=r(c,"userlocationTemplate");"string"==typeof s&&s||(s="<div class='userlocation-suggestion' data-userlocation-row='@row@' data-userlocation-id='@id@'>@name@ </div>");var a=r(c,"userlocationValueField");"string"==typeof a&&a||(a="name");var i={};new UserLocationAutoComplete({selector:this,minChars:1,cache:!1,source:function(o,n){if(o=d.tools.clearName(o.toLocaleUpperCase()),i&&i[o])n(i[o]);else if(o){var e=l.extend(!0,{service:u.service,ctx:u.ctx},r(c,"data"),{method:"getLocation",query:o});if(t=l.Event(l.fn.userlocation.PROCESS_ACTION),c.trigger(t,[e]),t.isDefaultPrevented())return;l.ajax({url:u.actionUrl,type:"post",dataType:"json",cache:!1,data:e}).done(function(e){var t=e.data.result||{};i[o]=t,n(t)}).fail(void n({}))}},renderItem:function(e,t){e=e||{};var o=s.replace(new RegExp("@row@","g"),JSON.stringify(e));for(var n in e)o=o.replace(new RegExp("@"+n+"@","g"),e[n]);return o},onSelect:function(e,t,o){var n=l(o).data("userlocation-row")||{},s=n[a]||n.id;setTimeout(function(){c.val(s)},100),l(o).trigger("click")}}),c.on("focus",function(e){this.sc&&(this.sc.style.display="block")})}}),l(document).off("click touchend",l.fn.userlocation.selectors.locationItem).on("click touchend",l.fn.userlocation.selectors.locationItem,function(t){var o=l(this);o.is("a")&&t.preventDefault();var e=o.data("userlocationId"),n=l.extend(!0,{service:u.service,ctx:u.ctx},r(o,"data"),{method:"setLocation",id:e});l.ajax({url:u.actionUrl,type:"post",dataType:"json",cache:!1,data:n}).done(function(e){t=l.Event(l.fn.userlocation.PROCESS_SUCCESS),o.trigger(t,[e,n]),t.isDefaultPrevented()||s(l.fn.userlocation.methodActions.success,this,e,n)}).fail(function(e){t=l.Event(l.fn.userlocation.PROCESS_FAILURE),o.trigger(t,[e,n]),t.isDefaultPrevented()||s(l.fn.userlocation.methodActions.failure,this,e,n)})}),l(document).off("click touchend",l.fn.userlocation.selectors.locationConfirmClose).on("click touchend",l.fn.userlocation.selectors.locationConfirmClose,function(e){l(this).closest(l.fn.userlocation.selectors.locationConfirm).each(function(e){l(this).show().removeClass(l.fn.userlocation.defaults.cls.unconfirmed)})})},addMethodAction:function(e,t,o){return"function"==typeof o&&(l.fn.userlocation.methodActions[e]||(l.fn.userlocation.methodActions[e]={}),l.fn.userlocation.methodActions[e][t]=o,!0)},removeMethodAction:function(e,t){return l.fn.userlocation.methodActions[e]||(l.fn.userlocation.methodActions[e]={}),delete l.fn.userlocation.methodActions[e][t],!0}};d.tools={clearName:function(e){var t={"Ё":"Е","Й":"И","ё":"е","й":"и"};return e.replace(RegExp(Object.keys(t).join("|"),"gi"),function(e){return t[e]})}},d.init(),window.UserLocation=d}(window.jQuery);